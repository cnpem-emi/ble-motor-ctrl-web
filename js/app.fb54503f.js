(function(t){function e(e){for(var n,i,s=e[0],c=e[1],u=e[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&p.push(a[i][0]),a[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(p.length)p.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,s=1;s<r.length;s++){var c=r[s];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},a={app:0},o=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"3c72":function(t,e,r){},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("d3b7"),r("5cc6"),r("907a"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7");var n=r("2b0e"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",[r("Unsupported",{attrs:{unsupported:t.unsupported}}),r("v-progress-linear",{attrs:{color:t.loading_color,indeterminate:"",active:t.loading}}),t.$store.state.bluetooth.motors.length>0?r("v-list",{staticStyle:{"padding-bottom":"60px"}},t._l(t.$store.state.bluetooth.motors,(function(e){return r("Controls",{key:e.name,attrs:{motor:e},on:{position:function(r){return t.update_position(e,r)},movn:function(r){return t.update_moving(e,r)},lvio:function(r){return t.update_lvio(e,r)}}})})),1):t._e(),r("v-bottom-navigation",{staticStyle:{position:"fixed",bottom:"0"},attrs:{"background-color":"indigo",dark:""}},[t.pv.name?r("PV",{staticStyle:{width:"80%"},attrs:{pv:t.pv}}):t._e(),t.pv.name?r("Edit",{on:{change_pv:function(e){return t.change_pv(e)}}}):t._e(),t.$store.state.bluetooth.device?r("v-btn",{on:{click:t.toggle_bluetooth}},[r("span",[t._v("Disconnect")]),r("v-icon",[t._v(t._s(t.mdiBluetoothOff))])],1):r("v-btn",{on:{click:t.toggle_bluetooth}},[r("span",[t._v("Connect")]),r("v-icon",[t._v(t._s(t.mdiBluetoothConnect))])],1)],1)],1)},o=[],i=r("b85c"),s=r("1da1"),c=(r("96cf"),r("20bf"),r("d81d"),r("a630"),r("3ca3"),r("b0c0"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",[r("v-card",{staticClass:"mx-auto",attrs:{"max-width":"360",outlined:""}},[r("v-list-item",{attrs:{"three-line":""}},[r("v-list-item-content",[r("v-container",{attrs:{fluid:""}},[r("v-row",[r("div",{staticClass:"text-h6 mb-4",staticStyle:{"margin-bottom":"0 !important"}},[t._v(" "+t._s(t.motor.name)+" ")]),r("v-spacer"),r("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.motor.movn,expression:"motor.movn"}],staticClass:"rotate_move",attrs:{color:"blue"}},[t._v(t._s(t.mdiCogClockwise))])],1)],1),r("div",{staticClass:"text-h7 mb-5"},[t._v(t._s(t.motor.pv))]),r("v-container",{attrs:{fluid:""}},[r("v-row",{attrs:{align:"center"}},[r("v-col",{attrs:{cols:"1"}},[r("v-btn",{staticClass:"pos_buttons",attrs:{color:"indigo",dark:""},on:{click:function(e){return t.step_motor("-")}}},[t._v("-")])],1),r("v-col",{attrs:{cols:"4"}},[r("v-text-field",{attrs:{label:"Step (mm)",placeholder:"Eg.: 2.00000",dense:"",type:"number","hide-details":""},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}})],1),r("v-col",{attrs:{cols:"1"}},[r("v-btn",{staticClass:"pos_buttons",staticStyle:{"margin-right":"10px"},attrs:{color:"indigo",dark:""},on:{click:function(e){return t.step_motor("")}}},[t._v("+")])],1),r("v-spacer"),r("v-col",{attrs:{cols:"5"}},[r("v-text-field",{attrs:{label:"Position (mm)",placeholder:"Eg.: 12.00000",step:parseFloat(t.step),outlined:"",dense:"",type:"number","hide-details":"",append:""},model:{value:t.des_pos,callback:function(e){t.des_pos=e},expression:"des_pos"}})],1)],1)],1),r("span",{staticClass:"text-h7",staticStyle:{"text-align":"center",padding:"10px 0"}},[t._v(" "+t._s(t.motor.real_pos?t.motor.real_pos+" mm":"Unknown")+" "),r("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.motor.lvio,expression:"motor.lvio"}],attrs:{align:"center",color:"red"}},[t._v(t._s(t.mdiAlertOctagon))])],1),r("v-row",{staticStyle:{margin:"12px 0"}},[r("v-col",[r("v-btn",{attrs:{width:"100%",dark:"",color:"red"},on:{click:t.stop}},[t._v(" Stop ")])],1),r("v-col",[r("v-btn",{attrs:{width:"100%",dark:"",color:"indigo"},on:{click:t.apply_position}},[t._v(" Move ")])],1)],1)],1)],1)],1)],1)}),u=[],l=(r("99af"),r("94ed"));function d(t){return Uint8Array.from(Array.from(t).map((function(t){return t.charCodeAt(0)})))}var p={name:"Controls",props:["motor"],data:function(){return{step:1,des_pos:0,mdiCogClockwise:l["d"],mdiAlertOctagon:l["a"]}},methods:{update_lvio:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.motor.characteristic.getDescriptor(10516);case 2:return r=e.sent,e.next=5,r.readValue();case 5:n=e.sent,t.$emit("lvio","1"==t.dataview_to_string(n));case 7:case"end":return e.stop()}}),e)})))()},apply_position:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.motor.characteristic.writeValueWithoutResponse(d(t.des_pos));case 2:t.update_lvio();case 3:case"end":return e.stop()}}),e)})))()},step_motor:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.motor.characteristic.getDescriptor(10515);case 2:return n=r.sent,r.next=5,n.writeValue(d("".concat(t).concat(e.step)));case 5:e.update_lvio();case 6:case"end":return r.stop()}}),r)})))()},position_changed:function(t){this.$emit("position",this.dataview_to_string(t.target.value))},movn_changed:function(t){this.$emit("movn",this.dataview_to_string(t.target.value))},stop:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.motor.characteristic.getDescriptor(10517);case 3:return r=e.sent,e.next=6,r.writeValue(d("1"));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),alert(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.des_pos=t.motor.desired_pos,e.next=3,t.motor.characteristic.addEventListener("characteristicvaluechanged",t.position_changed);case 3:return e.next=5,t.motor.movn_char.addEventListener("characteristicvaluechanged",t.movn_changed);case 5:case"end":return e.stop()}}),e)})))()}},v=p,m=(r("6b2c"),r("2877")),h=r("6544"),f=r.n(h),_=r("8336"),g=r("b0af"),b=r("62ad"),x=r("a523"),w=r("132d"),k=r("da13"),y=r("5d23"),V=r("0fd9"),C=r("2fa4"),O=r("8654"),S=Object(m["a"])(v,c,u,!1,null,"06551f9d",null),j=S.exports;f()(S,{VBtn:_["a"],VCard:g["a"],VCol:b["a"],VContainer:x["a"],VIcon:w["a"],VListItem:k["a"],VListItemContent:y["a"],VRow:V["a"],VSpacer:C["a"],VTextField:O["a"]});var P=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-card",{attrs:{color:"indigo",flat:""}},[r("v-card-text",[t._v(t._s(this.pv.name)+": "+t._s(this.pv.value))])],1)},$=[],E={name:"PV",props:["pv"]},R=E,A=r("99d9"),B=Object(m["a"])(R,P,$,!1,null,"ab2479d6",null),D=B.exports;f()(B,{VCard:g["a"],VCardText:A["b"]});var T=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{attrs:{persistent:"","max-width":"600px"},model:{value:t.unsupported,callback:function(e){t.unsupported=e},expression:"unsupported"}},[r("v-card",[r("v-card-title",[r("span",{staticClass:"text-h5"},[t._v("Unsupported browser/device")])]),r("v-card-text",[t._v(" Your current browser/device is unsupported by the Bluetooth API, which is required for this application to function. ")]),r("v-card-text",[r("a",{attrs:{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=674737"}},[t._v("Why is Mozilla not implementing Web Bluetooth in Firefox?")])]),r("v-card-text",[r("a",{attrs:{href:"https://www.zdnet.com/article/apple-declined-to-implement-16-web-apis-in-safari-due-to-privacy-concerns/"}},[t._v("Why is Apple not implementing Web Bluetooth in Safari?")])]),r("v-card-text",[t._v(" Please move to one of the following browsers (or a Blink based browser) or try a new device: ")]),r("v-card-actions",[r("v-btn",{attrs:{text:"",href:"https://play.google.com/store/apps/details?id=com.android.chrome&hl=en&gl=US"}},[r("v-icon",[t._v(" "+t._s(t.mdiGoogleChrome)+" ")]),t._v(" Chrome ")],1),r("v-btn",{attrs:{text:"",href:"https://play.google.com/store/apps/details?id=com.microsoft.emmx&hl=en&gl=US"}},[r("v-icon",[t._v(" "+t._s(t.mdiMicrosoftEdge)+" ")]),t._v(" Edge ")],1),r("v-btn",{attrs:{text:"",href:"https://play.google.com/store/apps/details?id=com.opera.browser&hl=en&gl=US"}},[r("v-icon",[t._v(" "+t._s(t.mdiOpera)+" ")]),t._v(" Opera ")],1),r("v-btn",{attrs:{text:"",href:"https://www.bromite.org/"}},[r("v-icon",[t._v(" "+t._s(t.mdiWeb)+" ")]),t._v(" Bromite ")],1),r("v-btn",{attrs:{text:"",href:"https://apps.apple.com/us/app/bluefy-web-ble-browser/id1492822055"}},[r("v-icon",[t._v(" "+t._s(t.mdiWeb)+" ")]),t._v(" Bluefy (iOS) ")],1)],1)],1)],1)},U=[],W={props:["unsupported"],data:function(){return{mdiGoogleChrome:l["e"],mdiMicrosoftEdge:l["g"],mdiWeb:l["j"],mdiOpera:l["h"]}}},I=W,L=r("169a"),M=Object(m["a"])(I,T,U,!1,null,null,null),N=M.exports;f()(M,{VBtn:_["a"],VCard:g["a"],VCardActions:A["a"],VCardText:A["b"],VCardTitle:A["c"],VDialog:L["a"],VIcon:w["a"]});var z=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-dialog",{attrs:{"max-width":"600px"},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,a=e.attrs;return[r("v-btn",t._g(t._b({},"v-btn",a,!1),n),[r("span",[t._v("Change PV")]),t._v(" "),r("v-icon",[t._v(t._s(t.mdiPencil))])],1)]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[r("v-card",[r("v-card-title",[t._v(" Change PV ")]),r("v-card-text",[r("v-text-field",{attrs:{outline:"",placeholder:"PV Name"},model:{value:t.pv_name,callback:function(e){t.pv_name=e},expression:"pv_name"}})],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"grey darken-1",text:""},on:{click:function(e){t.dialog=!1}}},[t._v(" Close ")]),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(e){return t.change_pv()}}},[t._v(" Apply ")])],1)],1)],1)},F=[],q={name:"Edit",data:function(){return{mdiPencil:l["i"],pv_name:"",dialog:!1}},methods:{change_pv:function(){this.$emit("change_pv",this.pv_name),this.dialog=!1}}},G=q,J=Object(m["a"])(G,z,F,!1,null,"4794dada",null),H=J.exports;f()(J,{VBtn:_["a"],VCard:g["a"],VCardActions:A["a"],VCardText:A["b"],VCardTitle:A["c"],VDialog:L["a"],VIcon:w["a"],VSpacer:C["a"],VTextField:O["a"]});var Y="84e7f883-7c80-4b64-88a5-6077ce2e8925";function K(t){return Uint8Array.from(Array.from(t).map((function(t){return t.charCodeAt(0)})))}var Q={name:"BLEMotorCtrl",components:{Controls:j,Unsupported:N,PV:D,Edit:H},data:function(){return{real_positions:[],mdiHelpRhombus:l["f"],mdiBluetoothOff:l["c"],mdiBluetoothConnect:l["b"],loading:!1,loading_color:"blue",unsupported:!1,lock:!0,pv:{}}},methods:{toggle_bluetooth:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,n,a,o,s,c,u,l,d,p,v,m,h,f,_,g,b,x,w;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(void 0!==navigator.bluetooth){e.next=3;break}return t.unsupported=!0,e.abrupt("return");case 3:if(t.loading_color="blue",t.loading=!0,!t.$store.state.bluetooth.device){e.next=12;break}return e.next=8,t.$store.state.bluetooth.device.gatt.disconnect();case 8:t.$store.commit("disconnect_bluetooth"),t.pv={},e.next=104;break;case 12:return r={companyIdentifier:13},n={optionalServices:[Y],filters:[{manufacturerData:[r]}]},a={motors:[]},e.prev=15,e.next=18,navigator.bluetooth.requestDevice(n);case 18:return a.device=e.sent,e.next=21,a.device.gatt.connect();case 21:return a.server=e.sent,e.next=24,a.server.getPrimaryService(Y);case 24:a.service=e.sent,e.next=31;break;case 27:return e.prev=27,e.t0=e["catch"](15),t.$store.commit("show_snackbar","Could not connect to device, refresh the page and try again."),e.abrupt("return");case 31:return t.loading_color="green",e.next=34,a.service.getCharacteristics();case 34:o=e.sent,s=Object(i["a"])(o),e.prev=36,s.s();case 38:if((c=s.n()).done){e.next=95;break}if(u=c.value,l=u.uuid.substring(9,13),"710e"!==l){e.next=72;break}return e.next=44,u.getDescriptor(10512);case 44:return d=e.sent,e.next=47,u.getDescriptor(10513);case 47:return p=e.sent,e.next=50,u.getDescriptor(10514);case 50:return v=e.sent,e.next=53,u.getDescriptor(10516);case 53:return m=e.sent,e.next=56,d.readValue();case 56:return h=e.sent,e.next=59,u.readValue();case 59:return f=e.sent,e.next=62,p.readValue();case 62:return _=e.sent,e.next=65,m.readValue();case 65:return g=e.sent,e.next=68,v.readValue();case 68:b=e.sent,a.motors.push({name:t.dataview_to_string(h),pv:t.dataview_to_string(b),characteristic:u,real_pos:t.dataview_to_string(f),desired_pos:t.dataview_to_string(_),lvio:"1"===t.dataview_to_string(g)}),e.next=91;break;case 72:if("710f"!==l){e.next=81;break}return e.next=75,u.readValue();case 75:x=e.sent,w=parseInt(u.uuid.charAt(7))-2,a.motors[w]["movn"]="1"===t.dataview_to_string(x),a.motors[w]["movn_char"]=u,e.next=91;break;case 81:if("7110"!==l){e.next=91;break}return e.t1=u,e.t2=t,e.next=86,u.readValue();case 86:return e.t3=e.sent,e.t4=e.t2.dataview_to_string.call(e.t2,e.t3),t.pv={characteristic:e.t1,name:e.t4,value:"Waiting..."},e.next=91,u.addEventListener("characteristicvaluechanged",t.update_pv);case 91:return e.next=93,u.startNotifications();case 93:e.next=38;break;case 95:e.next=100;break;case 97:e.prev=97,e.t5=e["catch"](36),s.e(e.t5);case 100:return e.prev=100,s.f(),e.finish(100);case 103:t.$store.commit("set_bluetooth",a);case 104:t.loading=!1;case 105:case"end":return e.stop()}}),e,null,[[15,27],[36,97,100,103]])})))()},update_position:function(t,e){t.real_pos=e},update_moving:function(t,e){t.movn="1"===e},update_lvio:function(t,e){t.lvio=e},update_pv:function(t){this.pv.value=this.dataview_to_string(t.target.value)},change_pv:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.pv.name=t,e.pv.value="Waiting...",r.next=4,e.pv.characteristic.writeValue(K(t));case 4:case"end":return r.stop()}}),r)})))()}}},X=Q,Z=r("7496"),tt=r("b81c"),et=r("8860"),rt=r("8e36"),nt=Object(m["a"])(X,a,o,!1,null,null,null),at=nt.exports;f()(nt,{VApp:Z["a"],VBottomNavigation:tt["a"],VBtn:_["a"],VIcon:w["a"],VList:et["a"],VProgressLinear:rt["a"]});var ot=r("f309");n["a"].use(ot["a"]);var it=new ot["a"]({}),st=r("2f62");n["a"].use(st["a"]);var ct=new st["a"].Store({state:{bluetooth:{device:"",server:"",motors:[],service:""},snackbar:!1,message:""},mutations:{set_bluetooth:function(t,e){t.bluetooth=e},disconnect_bluetooth:function(t){t.bluetooth={device:"",server:"",motors:[],service:""}},show_snackbar:function(t,e){t.snackbar=!0,t.message=e},hide_snackbar:function(t){t.snackbar=!1}}}),ut=ct;n["a"].config.productionTip=!1,n["a"].mixin({methods:{dataview_to_string:function(t){for(var e=[],r=new TextDecoder("utf-8"),n=0;n<t.byteLength;n++)e.push(t.getUint8(n));return r.decode(new Uint8Array(e))}}}),new n["a"]({store:ut,vuetify:it,render:function(t){return t(at)}}).$mount("#app")},"6b2c":function(t,e,r){"use strict";r("3c72")}});
//# sourceMappingURL=app.fb54503f.js.map